@page "/upload-document"
@using Roovia.Interfaces
@inject ICdnService CdnService
@inject IJSRuntime JSRuntime
@rendermode InteractiveServer
<h3>Document Upload</h3>

<div class="card">
    <div class="card-body">
        <CdnFileUpload Category="documents"
                       Title="Upload Documents"
                       Description="Drag and drop documents here, or click to browse"
                       FileTypeHint="Accepted file types: PDF, DOC, DOCX, XLS, XLSX"
                       AcceptedFileTypes=".pdf,.doc,.docx,.xls,.xlsx"
                       OnFileUploaded="HandleFileUploaded"
                       MaxFileSize="10485760" />
    </div>
</div>

@if (!string.IsNullOrEmpty(uploadedFileUrl))
{
    <div class="alert alert-success mt-3">
        <p>Document uploaded successfully!</p>
        <p>
            <button @onclick="ViewDocument" class="btn btn-primary">
                <i class="fa-light fa-eye"></i> View Document
            </button>
        </p>
    </div>
}

@code {
    private string uploadedFileUrl;
    private string apiKey;

    protected override async Task OnInitializedAsync()
    {
        apiKey = CdnService.GetApiKey();
        await JSRuntime.InvokeVoidAsync("setCdnApiKey", apiKey);
    }

    private void HandleFileUploaded(CdnFileUpload.UploadedFileInfo fileInfo)
    {
        uploadedFileUrl = fileInfo.Url;
        StateHasChanged();
    }

    private async Task ViewDocument()
    {
        if (!string.IsNullOrEmpty(uploadedFileUrl))
        {
            await JSRuntime.InvokeVoidAsync("openUrlWithApiKey", uploadedFileUrl, apiKey);
        }
    }
}