@* @using Roovia.Interfaces


@using Roovia.Models.PropertyOwner

@using Roovia.Models
@using Roovia.Services
@using System.Globalization
@using static Roovia.Components.Elements.RVDropdown

@rendermode InteractiveServer
@page "/viewproperty"

<RVModal CloseOnBackdrop="true" CloseOnEsc="true" Icon="fas fa-eye" IsVisible="@IsVisible" Size="ModalSize.Large">
    <ChildContent>
        <div class="rv-modal-custom">
            <div class="container-fluid">
                <!-- Property Details Section -->
                <div class="roovia-panel mb-4">
                    <div class="roovia-panel-header">
                        <h5 class="roovia-panel-title">
                            <i class="fas fa-building me-2"></i>Property Details
                        </h5>
                    </div>
                    <div class="roovia-panel-body">
                        <!-- Owner Information (read-only) -->
                        <div class="roovia-col-md-12 p-5">
                            <h6 class="text-primary mb-3">
                                <i class="fas fa-user me-2"></i>Owner Information
                            </h6>
                            <RVTextbox Label="Owner"
                                       Value="@($"{owner.FirstName} {owner.LastName}")"
                                       Disabled="true"
                                       IconLeft="fas fa-user">
                            </RVTextbox>
                        </div>
                        <div class="roovia-grid-cols-1 roovia-grid-cols-md-2 roovia-grid gap-4">
                            <!-- Location Information -->
                            <div class="roovia-col-md-6">
                                <h6 class="text-primary mb-3">
                                    <i class="fas fa-map-marker-alt me-2"></i>Location Information
                                </h6>
                                <div class="mb-3">
                                    <RVTextbox Label="Street"
                                               Value="@Property.Address?.Street"
                                               Disabled="true"
                                               Placeholder="Street address"
                                               IconLeft="fas fa-road">
                                    </RVTextbox>
                                </div>
                                <div class="roovia-grid-cols-2 roovia-grid gap-3">
                                    <div>
                                        <RVTextbox Label="Unit Number"
                                                   Value="@Property.Address?.UnitNumber"
                                                   Disabled="true"
                                                   Placeholder="Unit #"
                                                   IconLeft="fas fa-building">
                                        </RVTextbox>
                                    </div>
                                    <div>
                                        <RVTextbox Label="Floor"
                                                   Value="@Property.Address?.Floor"
                                                   Disabled="true"
                                                   Placeholder="Floor level"
                                                   IconLeft="fas fa-layer-group">
                                        </RVTextbox>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <RVTextbox Label="Complex Name"
                                               Value="@Property.Address?.ComplexName"
                                               Disabled="true"
                                               Placeholder="Complex name"
                                               IconLeft="fas fa-hotel">
                                    </RVTextbox>
                                </div>
                                <div class="mb-3">
                                    <RVTextbox Label="Building Name"
                                               Value="@Property.Address?.BuildingName"
                                               Disabled="true"
                                               Placeholder="Building name"
                                               IconLeft="fas fa-building">
                                    </RVTextbox>
                                </div>
                            </div>

                            <!-- City/Region Information -->
                            <div class="roovia-col-md-6">
                                <h6 class="text-primary mb-3">
                                    <i class="fas fa-city me-2"></i>City/Region Information
                                </h6>
                                <div class="roovia-grid-cols-2 roovia-grid gap-3">
                                    <div>
                                        <RVTextbox Label="City"
                                                   Value="@Property.Address?.City"
                                                   Disabled="true"
                                                   Placeholder="City"
                                                   IconLeft="fas fa-city">
                                        </RVTextbox>
                                    </div>
                                    <div>
                                        <RVTextbox Label="Suburb"
                                                   Value="@Property.Address?.Suburb"
                                                   Disabled="true"
                                                   Placeholder="Suburb"
                                                   IconLeft="fas fa-map-pin">
                                        </RVTextbox>
                                    </div>
                                </div>
                                <div class="roovia-grid-cols-2 roovia-grid gap-3 mt-3">
                                    <div>
                                        <RVTextbox Label="Province"
                                                   Value="@Property.Address?.Province"
                                                   Disabled="true"
                                                   Placeholder="Province/State"
                                                   IconLeft="fas fa-map">
                                        </RVTextbox>
                                    </div>
                                    <div>
                                        <RVTextbox Label="Postal Code"
                                                   Value="@Property.Address?.PostalCode"
                                                   Disabled="true"
                                                   Placeholder="Postal/ZIP Code"
                                                   IconLeft="fas fa-mail-bulk">
                                        </RVTextbox>
                                    </div>
                                </div>
                                <div class="mb-3 mt-3">
                                    <RVTextbox Label="Country"
                                               Value="@Property.Address?.Country"
                                               Disabled="true"
                                               Placeholder="Country"
                                               IconLeft="fas fa-globe">
                                    </RVTextbox>
                                </div>
                                <div class="mb-3">
                                    <RVCheckbox Label="Is Residential"
                                                Value="@(Property?.Address?.IsResidential ?? false)"
                                                Disabled="true">
                                    </RVCheckbox>
                                </div>
                            </div>
                        </div>

                        <!-- Access Information Section -->
                        <div class="roovia-panel-subsection mt-4">
                            <h6 class="text-primary mb-3">
                                <i class="fas fa-unlock-alt me-2"></i>Access Information
                            </h6>
                            <div class="roovia-grid-cols-1 roovia-grid-cols-md-2 roovia-grid gap-3">
                                <div>
                                    <RVTextbox Label="Gate Code"
                                               Value="@Property.Address?.GateCode"
                                               Disabled="true"
                                               Placeholder="Gate code"
                                               IconLeft="fas fa-key">
                                    </RVTextbox>
                                </div>
                                <div>
                                    <RVTextbox Label="Delivery Instructions"
                                               Value="@Property.Address?.DeliveryInstructions"
                                               Disabled="true"
                                               Placeholder="Delivery instructions"
                                               IconLeft="fas fa-info-circle">
                                    </RVTextbox>
                                </div>
                            </div>
                        </div>

                        <!-- Lease Information Section -->
                        <div class="roovia-panel-subsection mt-4">
                            <h6 class="text-primary mb-3">
                                <i class="fas fa-file-contract me-2"></i>Lease Information
                            </h6>
                            <div class="roovia-grid-cols-1 roovia-grid-cols-md-2 roovia-grid gap-3">
                                <div>
                                    <RVTextbox Label="Rental Amount"
                                               Value="@Property.RentalAmount.ToString()"
                                               Disabled="true"
                                               Placeholder="Monthly rent"
                                               IconLeft="fas fa-money-bill-wave">
                                    </RVTextbox>
                                </div>
                                <div>
                                    <div class="form-floating mb-3">
                                        <div class="rv-form-group">
                                            <label class="form-label">
                                                <i class="fas fa-calendar-alt me-2"></i>Lease Original Start Date
                                            </label>
                                            <input type="datetime-local"
                                                   class="custom-datetime-input"
                                                   value="@(Property.LeaseOriginalStartDate.HasValue ? Property.LeaseOriginalStartDate.Value.ToString("yyyy-MM-ddTHH:mm") : string.Empty)"
                                                   disabled />
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="roovia-grid-cols-1 roovia-grid-cols-md-2 roovia-grid gap-3 mt-3">
                                <div>
                                    <div class="form-floating mb-3">
                                        <div class="rv-form-group">
                                            <label class="roovia-textbox-label">
                                                <i class="fas fa-calendar-check me-2"></i>Current Lease Start Date
                                            </label>
                                            <input type="datetime-local"
                                                   class="custom-datetime-input"
                                                   value="@(Property.CurrentLeaseStartDate.HasValue ? Property.CurrentLeaseStartDate.Value.ToString("yyyy-MM-ddTHH:mm") : string.Empty)"
                                                   disabled />
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <div class="form-floating mb-3">
                                        <div class="rv-form-group">
                                            <label class="roovia-textbox-label">
                                                <i class="fas fa-calendar-times me-2"></i>Lease End Date
                                            </label>
                                            <input type="datetime-local"
                                                   class="custom-datetime-input"
                                                   value="@(Property.LeaseEndDate.HasValue ? Property.LeaseEndDate.Value.ToString("yyyy-MM-ddTHH:mm") : string.Empty)"
                                                   disabled />
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </ChildContent>
    <FooterContent>
        <div class="d-flex justify-end w-100">
            <button class="btn roovia-btn-secondary" @onclick="CloseModal">
                <i class="fas fa-times me-1"></i> Close
            </button>
        </div>
    </FooterContent>
</RVModal>

@code {
    [CascadingParameter]
    public Property Property { get; set; } = new Property();

    [CascadingParameter]
    public ApplicationUser CurrentUser { get; set; } = new();

    [Parameter]
    public EventCallback<bool> OnModalClosed { get; set; }

    [Inject]
    public IPropertyOwner PropertyOwnerService { get; set; }

    bool IsVisible = true;

    PropertyOwner owner = new();

    protected override async Task OnInitializedAsync()
    {
        if (owner.Id == 0)
        {
            await LoadOwnerDetails();
        }
    }
    public async Task LoadOwnerDetails()
    {
        var ownerResponse = await PropertyOwnerService.GetPropertyOwnerById(CurrentUser.CompanyId.Value, Property.OwnerId);
        if (ownerResponse.ResponseInfo.Success)
        {
            owner = ownerResponse.Response as PropertyOwner;
        }
    }

    private async Task CloseModal()
    {
        IsVisible = false;
        await OnModalClosed.InvokeAsync(true);
    }
}

<style>
    .rv-modal-custom {
        max-width: 100%;
        margin: 0 auto;
    }

    .roovia-panel {
        background-color: var(--content-bg);
        border-radius: var(--border-radius-lg);
        box-shadow: var(--shadow-sm);
        border: 1px solid var(--border-divider);
        overflow: hidden;
        transition: var(--card-transition);
    }

    .roovia-panel-header {
        padding: 1rem;
        border-bottom: 1px solid var(--border-divider);
        background-color: var(--subtle-bg);
    }

    .roovia-panel-body {
        padding: 1.5rem;
    }

    .roovia-panel-subsection {
        padding-top: 1rem;
        border-top: 1px solid var(--border-light);
    }

    .rv-form-group {
        margin-bottom: 1rem;
    }

    .rv-form-label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 500;
        color: var(--text-primary);
    }

    .custom-datetime-input {
        padding: 0.5rem;
        border: 1px solid var(--border-color);
        border-radius: 0.25rem;
        font-size: 1rem;
        background-color: var(--content-bg);
        color: var(--text-primary);
        transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
    }

        .custom-datetime-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 5px var(--primary);
        }
</style> *@