@* @using Microsoft.AspNetCore.Components
@using Roovia.Models.BusinessModels
@using Roovia.Models.BusinessHelperModels
@using Roovia.Models.BusinessMappingModels

<div class="property-modal-overlay" @onclick="HandleOverlayClick">
    <div class="property-modal" @onclick:stopPropagation="true">
        <div class="property-modal-header">
            <h3 class="property-modal-title">Edit Property - @Property.PropertyCode</h3>
            <button class="property-modal-close" @onclick="Cancel">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <div class="property-modal-body">
            <form @onsubmit:preventDefault="true">
                <div class="property-form-tabs">
                    <button type="button" class="property-form-tab @(activeTab == "basic" ? "active" : "")" @onclick='() => activeTab = "basic"'>
                        Basic Information
                    </button>
                    <button type="button" class="property-form-tab @(activeTab == "address" ? "active" : "")" @onclick='() => activeTab = "address"'>
                        Address
                    </button>
                    <button type="button" class="property-form-tab @(activeTab == "lease" ? "active" : "")" @onclick='() => activeTab = "lease"'>
                        Lease Information
                    </button>
                    <button type="button" class="property-form-tab @(activeTab == "commission" ? "active" : "")" @onclick='() => activeTab = "commission"'>
                        Commission
                    </button>
                </div>

                @if (activeTab == "basic")
                {
                    <div class="property-form-section">
                        <div class="property-form-row">
                            <div class="property-form-group">
                                <label class="property-form-label">Property Name*</label>
                                <input type="text" class="property-form-input" @bind="Property.PropertyName" required />
                            </div>

                            <div class="property-form-group">
                                <label class="property-form-label">Property Code*</label>
                                <input type="text" class="property-form-input" @bind="Property.PropertyCode" required />
                            </div>
                        </div>

                        <div class="property-form-row">
                            <div class="property-form-group">
                                <label class="property-form-label">Owner*</label>
                                <select class="property-form-select" @bind="Property.OwnerId" required>
                                    @foreach (var owner in PropertyOwners)
                                    {
                                        <option value="@owner.Id">@owner.FullName</option>
                                    }
                                </select>
                            </div>

                            <div class="property-form-group">
                                <label class="property-form-label">Status*</label>
                                <select class="property-form-select" @bind="Property.StatusId" required>
                                    @foreach (var status in PropertyStatuses)
                                    {
                                        <option value="@status.Id">@status.Name</option>
                                    }
                                </select>
                            </div>
                        </div>

                        <div class="property-form-row">
                            <div class="property-form-group">
                                <label class="property-form-label">Rental Amount (R)</label>
                                <input type="number" class="property-form-input" @bind="Property.RentalAmount" step="0.01" />
                            </div>

                            <div class="property-form-group">
                                <label class="property-form-label">Service Level</label>
                                <input type="text" class="property-form-input" @bind="Property.ServiceLevel" />
                            </div>
                        </div>

                        <div class="property-form-row">
                            <div class="property-form-group">
                                <label class="property-form-label">Customer Reference</label>
                                <input type="text" class="property-form-input" @bind="Property.CustomerRef" />
                            </div>

                            <div class="property-form-group">
                                <label class="property-form-label">Account Balance (R)</label>
                                <input type="number" class="property-form-input" @bind="Property.PropertyAccountBalance" step="0.01" />
                            </div>
                        </div>
                    </div>
                }

                @if (activeTab == "address")
                {
                    <div class="property-form-section">
                        <div class="property-form-row">
                            <div class="property-form-group property-form-group-full">
                                <label class="property-form-label">Street Address</label>
                                <input type="text" class="property-form-input" @bind="Property.Address.Street" />
                            </div>
                        </div>

                        <div class="property-form-row">
                            <div class="property-form-group">
                                <label class="property-form-label">Unit Number</label>
                                <input type="text" class="property-form-input" @bind="Property.Address.UnitNumber" />
                            </div>

                            <div class="property-form-group">
                                <label class="property-form-label">Floor</label>
                                <input type="text" class="property-form-input" @bind="Property.Address.Floor" />
                            </div>

                            <div class="property-form-group">
                                <label class="property-form-label">Complex Name</label>
                                <input type="text" class="property-form-input" @bind="Property.Address.ComplexName" />
                            </div>

                            <div class="property-form-group">
                                <label class="property-form-label">Building Name</label>
                                <input type="text" class="property-form-input" @bind="Property.Address.BuildingName" />
                            </div>
                        </div>

                        <div class="property-form-row">
                            <div class="property-form-group">
                                <label class="property-form-label">City</label>
                                <input type="text" class="property-form-input" @bind="Property.Address.City" />
                            </div>

                            <div class="property-form-group">
                                <label class="property-form-label">Suburb</label>
                                <input type="text" class="property-form-input" @bind="Property.Address.Suburb" />
                            </div>

                            <div class="property-form-group">
                                <label class="property-form-label">Province</label>
                                <input type="text" class="property-form-input" @bind="Property.Address.Province" />
                            </div>

                            <div class="property-form-group">
                                <label class="property-form-label">Postal Code</label>
                                <input type="text" class="property-form-input" @bind="Property.Address.PostalCode" />
                            </div>
                        </div>

                        <div class="property-form-row">
                            <div class="property-form-group">
                                <label class="property-form-label">Country</label>
                                <input type="text" class="property-form-input" @bind="Property.Address.Country" />
                            </div>

                            <div class="property-form-group">
                                <label class="property-form-label">Gate Code</label>
                                <input type="text" class="property-form-input" @bind="Property.Address.GateCode" />
                            </div>
                        </div>

                        <div class="property-form-row">
                            <div class="property-form-group property-form-group-full">
                                <label class="property-form-label">Delivery Instructions</label>
                                <textarea class="property-form-textarea" @bind="Property.Address.DeliveryInstructions" rows="3"></textarea>
                            </div>
                        </div>

                        <div class="property-form-row">
                            <div class="property-form-group">
                                <label class="property-form-checkbox">
                                    <input type="checkbox" @bind="Property.Address.IsResidential" />
                                    <span>Is Residential Property</span>
                                </label>
                            </div>
                        </div>
                    </div>
                }

                @if (activeTab == "lease")
                {
                    <div class="property-form-section">
                        <div class="property-form-row">
                            <div class="property-form-group">
                                <label class="property-form-checkbox">
                                    <input type="checkbox" @bind="Property.HasTenant" />
                                    <span>Property Has Tenant</span>
                                </label>
                            </div>
                        </div>

                        @if (Property.HasTenant)
                        {
                            <div class="property-form-row">
                                <div class="property-form-group">
                                    <label class="property-form-label">Lease Original Start Date</label>
                                    <input type="date" class="property-form-input" @bind="Property.LeaseOriginalStartDate" />
                                </div>

                                <div class="property-form-group">
                                    <label class="property-form-label">Current Lease Start Date</label>
                                    <input type="date" class="property-form-input" @bind="Property.CurrentLeaseStartDate" />
                                </div>
                            </div>

                            <div class="property-form-row">
                                <div class="property-form-group">
                                    <label class="property-form-label">Lease End Date</label>
                                    <input type="date" class="property-form-input" @bind="Property.LeaseEndDate" />
                                </div>

                                <div class="property-form-group">
                                    <label class="property-form-label">Current Tenant ID</label>
                                    <input type="number" class="property-form-input" @bind="Property.CurrentTenantId" readonly />
                                </div>
                            </div>
                        }
                    </div>
                }

                @if (activeTab == "commission")
                {
                    <div class="property-form-section">
                        <div class="property-form-row">
                            <div class="property-form-group">
                                <label class="property-form-label">Commission Type</label>
                                <select class="property-form-select" @bind="Property.CommissionTypeId">
                                    @foreach (var type in CommissionTypes)
                                    {
                                        <option value="@type.Id">@type.Name</option>
                                    }
                                </select>
                            </div>

                            <div class="property-form-group">
                                <label class="property-form-label">Commission Value</label>
                                <input type="number" class="property-form-input" @bind="Property.CommissionValue" step="0.01" />
                            </div>
                        </div>

                        <div class="property-form-row">
                            <div class="property-form-group">
                                <label class="property-form-checkbox">
                                    <input type="checkbox" @bind="Property.PaymentsEnabled" />
                                    <span>Enable Payments</span>
                                </label>
                            </div>

                            <div class="property-form-group">
                                <label class="property-form-checkbox">
                                    <input type="checkbox" @bind="Property.PaymentsVerify" />
                                    <span>Verify Payments</span>
                                </label>
                            </div>
                        </div>
                    </div>
                }
            </form>
        </div>

        <div class="property-modal-footer">
            <button class="property-btn property-btn-outline" @onclick="Cancel">Cancel</button>
            <button class="property-btn property-btn-primary" @onclick="Save">Update Property</button>
        </div>
    </div>
</div>

@code {
    [Parameter] public Property Property { get; set; } = new();
    [Parameter] public EventCallback<Property> OnSave { get; set; }
    [Parameter] public EventCallback OnCancel { get; set; }
    [Parameter] public List<PropertyStatusType> PropertyStatuses { get; set; } = new();
    [Parameter] public List<PropertyOwner> PropertyOwners { get; set; } = new();
    [Parameter] public List<CommissionType> CommissionTypes { get; set; } = new();

    private string activeTab = "basic";

    private async Task Save()
    {
        if (ValidateProperty())
        {
            await OnSave.InvokeAsync(Property);
        }
    }

    private async Task Cancel()
    {
        await OnCancel.InvokeAsync();
    }

    private void HandleOverlayClick()
    {
        Cancel();
    }

    private bool ValidateProperty()
    {
        if (string.IsNullOrWhiteSpace(Property.PropertyName))
            return false;

        if (string.IsNullOrWhiteSpace(Property.PropertyCode))
            return false;

        if (Property.OwnerId == 0)
            return false;

        return true;
    }
}

<style>
    /* Using the same modal styles from CreatePropertyModal */

    .property-form-tabs {
        display: flex;
        gap: 1rem;
        margin-bottom: 2rem;
        border-bottom: 2px solid var(--border-light);
    }

    .property-form-tab {
        background: none;
        border: none;
        padding: 0.75rem 1rem;
        font-size: 0.875rem;
        font-weight: 500;
        color: var(--text-muted);
        cursor: pointer;
        position: relative;
        transition: color 0.2s;
    }

        .property-form-tab:hover {
            color: var(--text-primary);
        }

        .property-form-tab.active {
            color: var(--primary);
        }

            .property-form-tab.active::after {
                content: '';
                position: absolute;
                bottom: -2px;
                left: 0;
                right: 0;
                height: 2px;
                background-color: var(--primary);
            }

    .property-form-textarea {
        padding: 0.75rem;
        border: 1px solid var(--border-color);
        border-radius: 6px;
        font-size: 1rem;
        font-family: inherit;
        background-color: var(--content-bg);
        color: var(--text-primary);
        resize: vertical;
        transition: border-color 0.2s;
    }

        .property-form-textarea:focus {
            outline: none;
            border-color: var(--primary);
        }
</style> *@