@inherits LayoutComponentBase

<div class="roovia-page" id="app-container">
    <div class="roovia-sidebar" id="sidebarContainer">
        <NavMenu />
    </div>

    <main class="roovia-main">
        <div class="roovia-topbar">
            <div class="roovia-topbar-content">
                <!-- Mobile menu toggle integrated directly in topbar -->
                <div class="roovia-menu-toggle-wrapper">
                    <button id="mobile-menu-toggle" class="roovia-mobile-menu-toggle" onclick="toggleMobileMenu(event)">
                        <i class="fal fa-bars"></i>
                    </button>
                </div>

                <div class="roovia-logo">
                    <i class="fal fa-building"></i>
                    <span>Roovia</span>
                </div>

                <div class="roovia-topbar-actions">
                    <button class="roovia-btn roovia-btn-sm roovia-btn-secondary">
                        <i class="fal fa-user"></i>
                        <span>Account</span>
                    </button>
                    <button class="roovia-btn roovia-btn-sm roovia-btn-secondary">
                        <i class="fal fa-cog"></i>
                    </button>
                    <button id="theme-toggle-btn" class="roovia-btn roovia-btn-sm roovia-btn-secondary" onclick="toggleTheme()">
                        <i class="fal fa-moon" id="theme-toggle-icon"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Sidebar toggle button is now inside the content area for better positioning -->
        <button class="roovia-sidebar-toggle" onclick="toggleSidebar(event)">
            <i class="fal fa-chevron-left" id="sidebar-toggle-icon"></i>
        </button>

        <div class="roovia-content">
            <div class="roovia-content-container">
                @Body
            </div>
        </div>
    </main>
</div>

<div id="blazor-error-ui" data-nosnippet>
    <div class="roovia-alert roovia-alert-danger">
        <div class="roovia-alert-content">
            <i class="fal fa-exclamation-triangle"></i>
            <div>
                <div class="roovia-alert-title">An unhandled error has occurred.</div>
                <div class="d-flex gap-3 mt-2">
                    <a href="." class="roovia-btn roovia-btn-sm roovia-btn-danger">Reload</a>
                    <span class="dismiss roovia-btn roovia-btn-sm roovia-btn-secondary">Dismiss</span>
                </div>
            </div>
        </div>
    </div>
</div>

@code {
    // No C# event handlers needed
}

<script>
    // Theme Toggle - Applied directly to HTML root element
    function toggleTheme() {
        const container = document.documentElement; // Use HTML root element
        const icon = document.getElementById('theme-toggle-icon');

        if (container.classList.contains('theme-dark')) {
            container.classList.remove('theme-dark');
            localStorage.setItem('theme', 'light');
            if (icon) {
                icon.classList.remove('fa-sun');
                icon.classList.add('fa-moon');
            }
        } else {
            container.classList.add('theme-dark');
            localStorage.setItem('theme', 'dark');
            if (icon) {
                icon.classList.remove('fa-moon');
                icon.classList.add('fa-sun');
            }
        }
    }

    // Toggle mobile menu
    function toggleMobileMenu(event) {
        if (event) event.stopPropagation();

        const sidebarContainer = document.getElementById('sidebarContainer');
        if (!sidebarContainer) return;

        if (sidebarContainer.classList.contains('mobile-open')) {
            sidebarContainer.classList.remove('mobile-open');
        } else {
            sidebarContainer.classList.add('mobile-open');
        }
    }

    // Function for NavMenu to close mobile menu
    function closeNavMenuMobile(event) {
        if (event) event.stopPropagation();

        const sidebarContainer = document.getElementById('sidebarContainer');
        if (!sidebarContainer) return;

        sidebarContainer.classList.remove('mobile-open');
    }

    // Toggle sidebar collapsed state
    function toggleSidebar(event) {
        if (event) event.stopPropagation();

        const sidebarContainer = document.getElementById('sidebarContainer');
        const icon = document.getElementById('sidebar-toggle-icon');
        if (!sidebarContainer) return;

        if (sidebarContainer.classList.contains('collapsed')) {
            sidebarContainer.classList.remove('collapsed');
            localStorage.setItem('sidebar_state', 'expanded');
            if (icon) {
                icon.classList.remove('fa-chevron-right');
                icon.classList.add('fa-chevron-left');
            }
        } else {
            sidebarContainer.classList.add('collapsed');
            localStorage.setItem('sidebar_state', 'collapsed');
            if (icon) {
                icon.classList.remove('fa-chevron-left');
                icon.classList.add('fa-chevron-right');
            }
        }
    }

    // Initialize theme from localStorage
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize theme
        const savedTheme = localStorage.getItem('theme');
        const themeIcon = document.getElementById('theme-toggle-icon');

        if (savedTheme === 'dark') {
            document.documentElement.classList.add('theme-dark');
            if (themeIcon) {
                themeIcon.classList.remove('fa-moon');
                themeIcon.classList.add('fa-sun');
            }
        }

        // Initialize sidebar state from localStorage
        const savedSidebarState = localStorage.getItem('sidebar_state');
        const sidebarContainer = document.getElementById('sidebarContainer');
        const sidebarIcon = document.getElementById('sidebar-toggle-icon');

        if (savedSidebarState === 'collapsed' && sidebarContainer) {
            sidebarContainer.classList.add('collapsed');
            if (sidebarIcon) {
                sidebarIcon.classList.remove('fa-chevron-left');
                sidebarIcon.classList.add('fa-chevron-right');
            }
        }

        // Setup event listeners for clicks outside mobile menu
        document.addEventListener('click', function(e) {
            const sidebarContainer = document.getElementById('sidebarContainer');
            const mobileToggle = document.getElementById('mobile-menu-toggle');

            // Close mobile menu when clicking outside (but not on the toggle button)
            if (window.innerWidth <= 991 &&
                sidebarContainer &&
                sidebarContainer.classList.contains('mobile-open') &&
                e.target !== mobileToggle &&
                !mobileToggle.contains(e.target) &&
                !sidebarContainer.contains(e.target)) {

                sidebarContainer.classList.remove('mobile-open');
            }
        });
    });

    // Responsive behavior
    window.addEventListener('resize', function() {
        const sidebarContainer = document.getElementById('sidebarContainer');
        // Auto-close mobile menu on resize to desktop
        if (window.innerWidth > 991 && sidebarContainer && sidebarContainer.classList.contains('mobile-open')) {
            sidebarContainer.classList.remove('mobile-open');
        }
    });
</script>