@implements IDisposable
@inject NavigationManager NavigationManager
@inject Roovia.Interfaces.IPermissionService PermissionService
@inject AuthenticationStateProvider AuthStateProvider

<div class="roovia-nav-header">
    <div class="roovia-nav-brand">
        <img src="/images/roovia-logo.png" alt="Roovia" class="roovia-nav-logo" />
    </div>
</div>

<div class="roovia-nav-menu" id="roovia-nav-menu">
    <!-- Dashboard Section - Available to everyone -->
    <div class="roovia-nav-section">
        <div class="roovia-nav-section-title">
            <span class="roovia-nav-section-title-full">Dashboard</span>
            <span class="roovia-nav-section-title-abbreviated">Dash</span>
        </div>
        <div class="roovia-nav-links">
            <NavLink class="roovia-nav-link" href="" Match="NavLinkMatch.All" title="Dashboard">
                <i class="fal fa-tachometer-alt"></i>
                <span>Dashboard</span>
            </NavLink>
        </div>
    </div>

    <!-- Property Management Section -->
    <Roovia.Security.PermissionAuthorizeView Category="properties">
        <div class="roovia-nav-section">
            <div class="roovia-nav-section-title">
                <span class="roovia-nav-section-title-full">Property Management</span>
                <span class="roovia-nav-section-title-abbreviated">Prop</span>
            </div>
            <div class="roovia-nav-links">
                <NavLink class="roovia-nav-link" href="properties" title="Properties">
                    <i class="fal fa-building"></i>
                    <span>Properties</span>
                </NavLink>

                <NavLink class="roovia-nav-link" href="properties/owners" title="Property Owners">
                    <i class="fal fa-user-hard-hat"></i>
                    <span>Owners</span>
                </NavLink>

                <Roovia.Security.PermissionAuthorizeView Permission="maintenance.tickets.create">
                    <NavLink class="roovia-nav-link" href="properties/maintenance" title="Maintenance">
                        <i class="fal fa-tools"></i>
                        <span>Maintenance</span>
                    </NavLink>
                </Roovia.Security.PermissionAuthorizeView>

                <Roovia.Security.PermissionAuthorizeView Permission="inspections.create">
                    <NavLink class="roovia-nav-link" href="properties/inspections" title="Inspections">
                        <i class="fal fa-clipboard-check"></i>
                        <span>Inspections</span>
                    </NavLink>
                </Roovia.Security.PermissionAuthorizeView>

                <Roovia.Security.PermissionAuthorizeView Permission="properties.budgets">
                    <NavLink class="roovia-nav-link" href="properties/budgets" title="Property Budgets">
                        <i class="fal fa-wallet"></i>
                        <span>Budgets</span>
                    </NavLink>
                </Roovia.Security.PermissionAuthorizeView>

                <Roovia.Security.PermissionAuthorizeView Permission="documents.view">
                    <NavLink class="roovia-nav-link" href="properties/documents" title="Property Documents">
                        <i class="fal fa-file-alt"></i>
                        <span>Documents</span>
                    </NavLink>
                </Roovia.Security.PermissionAuthorizeView>
            </div>
        </div>
    </Roovia.Security.PermissionAuthorizeView>

    <!-- Tenant Management Section -->
    <Roovia.Security.PermissionAuthorizeView Category="tenants">
        <div class="roovia-nav-section">
            <div class="roovia-nav-section-title">
                <span class="roovia-nav-section-title-full">Tenant Management</span>
                <span class="roovia-nav-section-title-abbreviated">Ten</span>
            </div>
            <div class="roovia-nav-links">
                <NavLink class="roovia-nav-link" href="tenants" title="Tenants">
                    <i class="fal fa-people-roof"></i>
                    <span>Tenants</span>
                </NavLink>

                <Roovia.Security.PermissionAuthorizeView Permission="tenants.lease.update">
                    <NavLink class="roovia-nav-link" href="tenants/leases" title="Tenant Leases">
                        <i class="fal fa-file-signature"></i>
                        <span>Leases</span>
                    </NavLink>
                </Roovia.Security.PermissionAuthorizeView>

                <Roovia.Security.PermissionAuthorizeView Permission="tenants.invoices">
                    <NavLink class="roovia-nav-link" href="tenants/invoices" title="Tenant Invoices">
                        <i class="fal fa-file-invoice-dollar"></i>
                        <span>Invoices</span>
                    </NavLink>
                </Roovia.Security.PermissionAuthorizeView>

                <Roovia.Security.PermissionAuthorizeView Permission="tenants.arrears.view">
                    <NavLink class="roovia-nav-link" href="tenants/arrears" title="Tenant Arrears">
                        <i class="fal fa-hand-holding-usd"></i>
                        <span>Arrears</span>
                    </NavLink>
                </Roovia.Security.PermissionAuthorizeView>

                <Roovia.Security.PermissionAuthorizeView Permission="tenants.tpn.view">
                    <NavLink class="roovia-nav-link" href="tenants/tpn" title="TPN Reports">
                        <i class="fal fa-credit-card"></i>
                        <span>TPN Reports</span>
                    </NavLink>
                </Roovia.Security.PermissionAuthorizeView>

                <Roovia.Security.PermissionAuthorizeView Permission="tenants.credit.check">
                    <NavLink class="roovia-nav-link" href="tenants/credit-checks" title="Credit Checks">
                        <i class="fal fa-id-card-alt"></i>
                        <span>Credit Checks</span>
                    </NavLink>
                </Roovia.Security.PermissionAuthorizeView>
            </div>
        </div>
    </Roovia.Security.PermissionAuthorizeView>

    <!-- Beneficiary Management Section -->
    <Roovia.Security.PermissionAuthorizeView Category="beneficiaries">
        <div class="roovia-nav-section">
            <div class="roovia-nav-section-title">
                <span class="roovia-nav-section-title-full">Beneficiary Management</span>
                <span class="roovia-nav-section-title-abbreviated">Ben</span>
            </div>
            <div class="roovia-nav-links">
                <NavLink class="roovia-nav-link" href="beneficiaries" title="Beneficiaries">
                    <i class="fal fa-users"></i>
                    <span>Beneficiaries</span>
                </NavLink>

                <Roovia.Security.PermissionAuthorizeView Permission="beneficiaries.payments">
                    <NavLink class="roovia-nav-link" href="beneficiaries/payments" title="Beneficiary Payments">
                        <i class="fal fa-money-check-alt"></i>
                        <span>Payments</span>
                    </NavLink>
                </Roovia.Security.PermissionAuthorizeView>

                <Roovia.Security.PermissionAuthorizeView Permission="beneficiaries.calculate">
                    <NavLink class="roovia-nav-link" href="beneficiaries/calculations" title="Payment Calculations">
                        <i class="fal fa-calculator"></i>
                        <span>Calculations</span>
                    </NavLink>
                </Roovia.Security.PermissionAuthorizeView>

                <Roovia.Security.PermissionAuthorizeView Permission="beneficiaries.payments.history">
                    <NavLink class="roovia-nav-link" href="beneficiaries/history" title="Payment History">
                        <i class="fal fa-history"></i>
                        <span>Payment History</span>
                    </NavLink>
                </Roovia.Security.PermissionAuthorizeView>
            </div>
        </div>
    </Roovia.Security.PermissionAuthorizeView>

    <!-- Financial Management Section -->
    <Roovia.Security.PermissionAuthorizeView Category="payments">
        <div class="roovia-nav-section">
            <div class="roovia-nav-section-title">
                <span class="roovia-nav-section-title-full">Financial Management</span>
                <span class="roovia-nav-section-title-abbreviated">Fin</span>
            </div>
            <div class="roovia-nav-links">
                <NavLink class="roovia-nav-link" href="finance/transactions" title="Transactions">
                    <i class="fal fa-exchange-alt"></i>
                    <span>Transactions</span>
                </NavLink>

                <Roovia.Security.PermissionAuthorizeView Permission="payments.deposits.view">
                    <NavLink class="roovia-nav-link" href="finance/deposits" title="Direct Deposits">
                        <i class="fal fa-money-bill-wave"></i>
                        <span>Direct Deposits</span>
                    </NavLink>
                </Roovia.Security.PermissionAuthorizeView>

                <Roovia.Security.PermissionAuthorizeView Permission="payments.approve">
                    <NavLink class="roovia-nav-link" href="finance/approvals" title="Payment Approvals">
                        <i class="fal fa-clipboard-list-check"></i>
                        <span>Payment Approvals</span>
                    </NavLink>
                </Roovia.Security.PermissionAuthorizeView>

                <Roovia.Security.PermissionAuthorizeView Permission="payments.allocate">
                    <NavLink class="roovia-nav-link" href="finance/allocations" title="Payment Allocations">
                        <i class="fal fa-random"></i>
                        <span>Allocations</span>
                    </NavLink>
                </Roovia.Security.PermissionAuthorizeView>

                <Roovia.Security.PermissionAuthorizeView Permission="payments.schedules">
                    <NavLink class="roovia-nav-link" href="finance/schedules" title="Payment Schedules">
                        <i class="fal fa-calendar-alt"></i>
                        <span>Schedules</span>
                    </NavLink>
                </Roovia.Security.PermissionAuthorizeView>

                <Roovia.Security.PermissionAuthorizeView Permission="payments.rules">
                    <NavLink class="roovia-nav-link" href="finance/rules" title="Payment Rules">
                        <i class="fal fa-sliders-h"></i>
                        <span>Rules & Settings</span>
                    </NavLink>
                </Roovia.Security.PermissionAuthorizeView>
            </div>
        </div>
    </Roovia.Security.PermissionAuthorizeView>

    <!-- Maintenance Management Section -->
    <Roovia.Security.PermissionAuthorizeView Category="maintenance">
        <div class="roovia-nav-section">
            <div class="roovia-nav-section-title">
                <span class="roovia-nav-section-title-full">Maintenance Management</span>
                <span class="roovia-nav-section-title-abbreviated">Maint</span>
            </div>
            <div class="roovia-nav-links">
                <NavLink class="roovia-nav-link" href="maintenance/tickets" title="Maintenance Tickets">
                    <i class="fal fa-ticket-alt"></i>
                    <span>Tickets</span>
                </NavLink>

                <Roovia.Security.PermissionAuthorizeView Permission="vendors.view.all">
                    <NavLink class="roovia-nav-link" href="maintenance/vendors" title="Vendors">
                        <i class="fal fa-hard-hat"></i>
                        <span>Vendors</span>
                    </NavLink>
                </Roovia.Security.PermissionAuthorizeView>

                <Roovia.Security.PermissionAuthorizeView Permission="maintenance.expenses">
                    <NavLink class="roovia-nav-link" href="maintenance/expenses" title="Maintenance Expenses">
                        <i class="fal fa-receipt"></i>
                        <span>Expenses</span>
                    </NavLink>
                </Roovia.Security.PermissionAuthorizeView>

                <Roovia.Security.PermissionAuthorizeView Permission="maintenance.statistics">
                    <NavLink class="roovia-nav-link" href="maintenance/statistics" title="Maintenance Statistics">
                        <i class="fal fa-chart-line"></i>
                        <span>Statistics</span>
                    </NavLink>
                </Roovia.Security.PermissionAuthorizeView>
            </div>
        </div>
    </Roovia.Security.PermissionAuthorizeView>

    <!-- Documents Section -->
    <Roovia.Security.PermissionAuthorizeView Category="documents">
        <div class="roovia-nav-section">
            <div class="roovia-nav-section-title">
                <span class="roovia-nav-section-title-full">Document Management</span>
                <span class="roovia-nav-section-title-abbreviated">Doc</span>
            </div>
            <div class="roovia-nav-links">
                <NavLink class="roovia-nav-link" href="documents" title="All Documents">
                    <i class="fal fa-folder-open"></i>
                    <span>All Documents</span>
                </NavLink>

                <Roovia.Security.PermissionAuthorizeView Permission="documents.upload">
                    <NavLink class="roovia-nav-link" href="documents/upload" title="Upload Documents">
                        <i class="fal fa-file-upload"></i>
                        <span>Upload</span>
                    </NavLink>
                </Roovia.Security.PermissionAuthorizeView>

                <Roovia.Security.PermissionAuthorizeView Permission="documents.approve">
                    <NavLink class="roovia-nav-link" href="documents/approvals" title="Document Approvals">
                        <i class="fal fa-file-check"></i>
                        <span>Approvals</span>
                    </NavLink>
                </Roovia.Security.PermissionAuthorizeView>

                <Roovia.Security.PermissionAuthorizeView Permission="documents.requirements">
                    <NavLink class="roovia-nav-link" href="documents/requirements" title="Document Requirements">
                        <i class="fal fa-clipboard-list"></i>
                        <span>Requirements</span>
                    </NavLink>
                </Roovia.Security.PermissionAuthorizeView>

                <Roovia.Security.PermissionAuthorizeView Permission="documents.types">
                    <NavLink class="roovia-nav-link" href="documents/types" title="Document Types">
                        <i class="fal fa-tags"></i>
                        <span>Types & Categories</span>
                    </NavLink>
                </Roovia.Security.PermissionAuthorizeView>
            </div>
        </div>
    </Roovia.Security.PermissionAuthorizeView>

    <!-- Communication Section -->
    <Roovia.Security.PermissionAuthorizeView Category="communications">
        <div class="roovia-nav-section">
            <div class="roovia-nav-section-title">
                <span class="roovia-nav-section-title-full">Communications</span>
                <span class="roovia-nav-section-title-abbreviated">Comm</span>
            </div>
            <div class="roovia-nav-links">
                <NavLink class="roovia-nav-link" href="communications/history" title="Communications History">
                    <i class="fal fa-comments-alt"></i>
                    <span>History</span>
                </NavLink>

                <Roovia.Security.PermissionAuthorizeView Permission="communications.email">
                    <NavLink class="roovia-nav-link" href="communications/email" title="Send Email">
                        <i class="fal fa-envelope"></i>
                        <span>Email</span>
                    </NavLink>
                </Roovia.Security.PermissionAuthorizeView>

                <Roovia.Security.PermissionAuthorizeView Permission="communications.sms">
                    <NavLink class="roovia-nav-link" href="communications/sms" title="Send SMS">
                        <i class="fal fa-sms"></i>
                        <span>SMS</span>
                    </NavLink>
                </Roovia.Security.PermissionAuthorizeView>

                <Roovia.Security.PermissionAuthorizeView Permission="communications.bulk">
                    <NavLink class="roovia-nav-link" href="communications/bulk" title="Bulk Communications">
                        <i class="fal fa-paper-plane"></i>
                        <span>Bulk Messages</span>
                    </NavLink>
                </Roovia.Security.PermissionAuthorizeView>

                <Roovia.Security.PermissionAuthorizeView Permission="communications.templates">
                    <NavLink class="roovia-nav-link" href="communications/templates" title="Communication Templates">
                        <i class="fal fa-copy"></i>
                        <span>Templates</span>
                    </NavLink>
                </Roovia.Security.PermissionAuthorizeView>
            </div>
        </div>
    </Roovia.Security.PermissionAuthorizeView>

    <!-- Reports Section -->
    <Roovia.Security.PermissionAuthorizeView Category="reports">
        <div class="roovia-nav-section">
            <div class="roovia-nav-section-title">
                <span class="roovia-nav-section-title-full">Reports</span>
                <span class="roovia-nav-section-title-abbreviated">Rep</span>
            </div>
            <div class="roovia-nav-links">
                <Roovia.Security.PermissionAuthorizeView Permission="reports.dashboard.view">
                    <NavLink class="roovia-nav-link" href="reports/dashboards" title="Report Dashboards">
                        <i class="fal fa-analytics"></i>
                        <span>Dashboards</span>
                    </NavLink>
                </Roovia.Security.PermissionAuthorizeView>

                <Roovia.Security.PermissionAuthorizeView Permission="reports.commission">
                    <NavLink class="roovia-nav-link" href="reports/commission" title="Commission Reports">
                        <i class="fal fa-percentage"></i>
                        <span>Commission</span>
                    </NavLink>
                </Roovia.Security.PermissionAuthorizeView>

                <Roovia.Security.PermissionAuthorizeView Permission="reports.transactions">
                    <NavLink class="roovia-nav-link" href="reports/transactions" title="Transaction Reports">
                        <i class="fal fa-chart-bar"></i>
                        <span>Transactions</span>
                    </NavLink>
                </Roovia.Security.PermissionAuthorizeView>

                <Roovia.Security.PermissionAuthorizeView Permission="reports.payments">
                    <NavLink class="roovia-nav-link" href="reports/payments" title="Payment Reports">
                        <i class="fal fa-file-invoice"></i>
                        <span>Payments</span>
                    </NavLink>
                </Roovia.Security.PermissionAuthorizeView>

                <Roovia.Security.PermissionAuthorizeView Permission="reports.statements">
                    <NavLink class="roovia-nav-link" href="reports/statements" title="Statements">
                        <i class="fal fa-file-alt"></i>
                        <span>Statements</span>
                    </NavLink>
                </Roovia.Security.PermissionAuthorizeView>

                <Roovia.Security.PermissionAuthorizeView Permission="reports.management">
                    <NavLink class="roovia-nav-link" href="reports/management" title="Management Reports">
                        <i class="fal fa-chart-pie"></i>
                        <span>Management</span>
                    </NavLink>
                </Roovia.Security.PermissionAuthorizeView>

                <Roovia.Security.PermissionAuthorizeView Permission="reports.audit">
                    <NavLink class="roovia-nav-link" href="reports/audit" title="Audit Logs">
                        <i class="fal fa-history"></i>
                        <span>Audit Logs</span>
                    </NavLink>
                </Roovia.Security.PermissionAuthorizeView>

                <Roovia.Security.PermissionAuthorizeView Permission="reports.custom.create">
                    <NavLink class="roovia-nav-link" href="reports/custom" title="Custom Reports">
                        <i class="fal fa-edit"></i>
                        <span>Custom Reports</span>
                    </NavLink>
                </Roovia.Security.PermissionAuthorizeView>

                <Roovia.Security.PermissionAuthorizeView Permission="reports.schedule">
                    <NavLink class="roovia-nav-link" href="reports/scheduled" title="Scheduled Reports">
                        <i class="fal fa-calendar-alt"></i>
                        <span>Scheduled Reports</span>
                    </NavLink>
                </Roovia.Security.PermissionAuthorizeView>
            </div>
        </div>
    </Roovia.Security.PermissionAuthorizeView>

    <!-- Administration Section -->
    <Roovia.Security.PermissionAuthorizeView Category="settings">
        <div class="roovia-nav-section">
            <div class="roovia-nav-section-title">
                <span class="roovia-nav-section-title-full">Administration</span>
                <span class="roovia-nav-section-title-abbreviated">Admin</span>
            </div>
            <div class="roovia-nav-links">
                <Roovia.Security.PermissionAuthorizeView Permission="settings.users">
                    <NavLink class="roovia-nav-link" href="admin/users" title="Users">
                        <i class="fal fa-users-cog"></i>
                        <span>Users</span>
                    </NavLink>
                </Roovia.Security.PermissionAuthorizeView>

                <Roovia.Security.PermissionAuthorizeView Permission="settings.permissions">
                    <NavLink class="roovia-nav-link" href="admin/roles" title="Role Management">
                        <i class="fal fa-shield-check"></i>
                        <span>Roles & Permissions</span>
                    </NavLink>
                </Roovia.Security.PermissionAuthorizeView>

                <Roovia.Security.PermissionAuthorizeView Permission="settings.companies">
                    <NavLink class="roovia-nav-link" href="admin/companies" title="Companies">
                        <i class="fal fa-building"></i>
                        <span>Companies</span>
                    </NavLink>
                </Roovia.Security.PermissionAuthorizeView>

                <Roovia.Security.PermissionAuthorizeView Permission="settings.branches">
                    <NavLink class="roovia-nav-link" href="admin/branches" title="Branches">
                        <i class="fal fa-code-branch"></i>
                        <span>Branches</span>
                    </NavLink>
                </Roovia.Security.PermissionAuthorizeView>

                <Roovia.Security.PermissionAuthorizeView Permission="settings.lookups">
                    <NavLink class="roovia-nav-link" href="admin/lookups" title="Lookup Tables">
                        <i class="fal fa-table"></i>
                        <span>Lookup Tables</span>
                    </NavLink>
                </Roovia.Security.PermissionAuthorizeView>

                <Roovia.Security.PermissionAuthorizeView Permission="settings.application">
                    <NavLink class="roovia-nav-link" href="admin/settings" title="Application Settings">
                        <i class="fal fa-cog"></i>
                        <span>Application Settings</span>
                    </NavLink>
                </Roovia.Security.PermissionAuthorizeView>

                <Roovia.Security.PermissionAuthorizeView Permission="settings.import">
                    <NavLink class="roovia-nav-link" href="admin/import" title="Import Data">
                        <i class="fal fa-file-import"></i>
                        <span>Import Data</span>
                    </NavLink>
                </Roovia.Security.PermissionAuthorizeView>

                <Roovia.Security.PermissionAuthorizeView Permission="settings.export">
                    <NavLink class="roovia-nav-link" href="admin/export" title="Export Data">
                        <i class="fal fa-file-export"></i>
                        <span>Export Data</span>
                    </NavLink>
                </Roovia.Security.PermissionAuthorizeView>

                <Roovia.Security.PermissionAuthorizeView Permission="settings.cdn">
                    <NavLink class="roovia-nav-link" href="admin/cdn" title="CDN Management">
                        <i class="fal fa-server"></i>
                        <span>CDN Management</span>
                    </NavLink>
                </Roovia.Security.PermissionAuthorizeView>

                <Roovia.Security.PermissionAuthorizeView Permission="settings.logs">
                    <NavLink class="roovia-nav-link" href="admin/logs" title="System Logs">
                        <i class="fal fa-bug"></i>
                        <span>System Logs</span>
                    </NavLink>
                </Roovia.Security.PermissionAuthorizeView>
            </div>
        </div>
    </Roovia.Security.PermissionAuthorizeView>

    <!-- Development Tools Section - Only visible to Global Admins -->
    <AuthorizeView Policy="GlobalAdminPolicy">
        <div class="roovia-nav-section">
            <div class="roovia-nav-section-title">
                <span class="roovia-nav-section-title-full">Dev Tools</span>
                <span class="roovia-nav-section-title-abbreviated">Dev</span>
            </div>
            <div class="roovia-nav-links">
                <NavLink class="roovia-nav-link" href="cdn-dashboard" title="CDN">
                    <i class="fal fa-cloud-upload"></i>
                    <span>CDN Dashboard</span>
                </NavLink>

                <NavLink class="roovia-nav-link" href="components" title="UI Components">
                    <i class="fal fa-puzzle-piece"></i>
                    <span>UI Components</span>
                </NavLink>

                <NavLink class="roovia-nav-link" href="Components-Grid" title="Grid System">
                    <i class="fal fa-th"></i>
                    <span>Grid System</span>
                </NavLink>

                <NavLink class="roovia-nav-link" href="dev/status" title="System Status">
                    <i class="fal fa-heartbeat"></i>
                    <span>System Status</span>
                </NavLink>

                <NavLink class="roovia-nav-link" href="dev/performance" title="Performance Metrics">
                    <i class="fal fa-tachometer-fastest"></i>
                    <span>Performance</span>
                </NavLink>
            </div>
        </div>
    </AuthorizeView>
</div>

<div class="roovia-desktop-toggle-wrapper">
    <button class="roovia-desktop-menu-toggle" onclick="toggleSidebar(event)" title="Toggle sidebar">
        <i class="fal fa-angle-double-left" id="desktop-toggle-icon"></i>
    </button>
</div>

<div class="roovia-sidebar-footer">
    <div class="roovia-user-profile" onclick="toggleUserMenu()">
        <div class="roovia-user-avatar">
            <i class="fal fa-user"></i>
        </div>
        <div class="roovia-user-details">
            <div class="roovia-user-name">@(CurrentUser?.FullName ?? "Guest")</div>
            <div class="roovia-user-role">@(CurrentUser?.Role.ToString() ?? "Not logged in")</div>
        </div>
        <div class="roovia-user-dropdown-icon">
            <i class="fal fa-chevron-down"></i>
        </div>
    </div>

    <!-- User Menu Dropdown -->
    <div class="roovia-user-menu" id="userMenu">
        <div class="roovia-user-menu-header">
            <div class="roovia-user-menu-avatar">
                <i class="fal fa-user-circle"></i>
            </div>
            <div>
                <div class="roovia-user-menu-name">@(CurrentUser?.FullName ?? "Guest")</div>
                <div class="roovia-user-menu-email">@(CurrentUser?.Email ?? "Sign in to access your account")</div>
            </div>
        </div>

        <div class="roovia-user-menu-divider"></div>

        <AuthorizeView>
            <Authorized>
                <a href="Account/Manage" class="roovia-user-menu-item">
                    <i class="fal fa-user-cog"></i>
                    <span>My Profile</span>
                </a>
                <a href="Account/Manage/Preferences" class="roovia-user-menu-item">
                    <i class="fal fa-sliders-h"></i>
                    <span>Preferences</span>
                </a>
                <a href="Account/Manage/Notifications" class="roovia-user-menu-item">
                    <i class="fal fa-bell"></i>
                    <span>Notifications</span>
                </a>
                <a href="#" class="roovia-user-menu-item" onclick="toggleTheme(); return false;">
                    <i class="fal fa-moon" id="theme-toggle-icon"></i>
                    <span>Toggle Theme</span>
                </a>
                <form action="Account/Logout" method="post" class="roovia-user-menu-form">
                    <AntiforgeryToken />
                    <input type="hidden" name="ReturnUrl" value="@currentUrl" />
                    <button type="submit" class="roovia-user-menu-item roovia-user-menu-logout">
                        <i class="fal fa-sign-out-alt"></i>
                        <span>Logout</span>
                    </button>
                </form>
            </Authorized>
            <NotAuthorized>
                <a href="Account/Login" class="roovia-user-menu-item">
                    <i class="fal fa-sign-in-alt"></i>
                    <span>Login</span>
                </a>
                <a href="Account/Register" class="roovia-user-menu-item">
                    <i class="fal fa-user-plus"></i>
                    <span>Register</span>
                </a>
                <a href="#" class="roovia-user-menu-item" onclick="toggleTheme(); return false;">
                    <i class="fal fa-moon" id="theme-toggle-icon"></i>
                    <span>Toggle Theme</span>
                </a>
            </NotAuthorized>
        </AuthorizeView>
    </div>
</div>

@code {
    [Parameter]
    public ApplicationUser? CurrentUser { get; set; }

    private string? currentUrl;

    protected override void OnInitialized()
    {
        currentUrl = NavigationManager.ToBaseRelativePath(NavigationManager.Uri);
        NavigationManager.LocationChanged += OnLocationChanged;
    }

    private void OnLocationChanged(object? sender, LocationChangedEventArgs e)
    {
        currentUrl = NavigationManager.ToBaseRelativePath(e.Location);
        StateHasChanged();
    }

    public void Dispose()
    {
        NavigationManager.LocationChanged -= OnLocationChanged;
    }
}